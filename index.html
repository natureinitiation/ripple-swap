<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><title>XRP ↔ USDC • Live AMM</title>
<script src="https://unpkg.com/xrpl@3"></script>
<style>
  body{background:#0d1117;color:#c9d1d9;font-family:system-ui;margin:0}
  .c{max-width:520px;margin:30px auto;background:#161b22;border-radius:16px;overflow:hidden;box-shadow:0 10px 40px #0008}
  header{background:linear-gradient(135deg,#0066ff,#00d4ff);padding:40px;text-align:center;color:#fff}
  h1{font-size:28px;margin:0}
  .tvl{font-size:48px;font-weight:900;margin:15px 0}
  .btn{display:block;width:100%;padding:18px;margin:20px 0;background:#238636;color:#fff;font-size:20px;font-weight:bold;border:none;border-radius:12px;cursor:pointer}
  #qr img{width:280px;height:280px;border-radius:16px}
  #log{background:#0d1117;padding:15px;border-radius:8px;margin-top:20px;font-family:monospace}
</style></head><body>
<div class="c">
  <header><h1>XRP ↔ USDC</h1><div class="tvl" id="tvl">…</div><div>Live AMM • XRPL</div></header>
  <div style="padding:30px">
    <button class="btn" id="connect">Connect Xaman</button>
    <div id="qr" style="display:none;text-align:center"></div>
    <div id="actions" style="display:none;margin-top:30px">
      <input type="number" id="amt" placeholder="Сумма XRP" value="100" style="width:100%;padding:16px;margin:20px 0;border-radius:12px;background:#21262d;color:#fff;border:1px solid #30363d;font-size:18px">
      <button class="btn" onclick="swap()">Swap XRP → USDC</button>
      <button class="btn" onclick="swapBack()">Swap USDC → XRP</button>
    </div>
    <pre id="log">Готов к подключению…</pre>
  </div>
</div>

<script>
const client = new xrpl.Client("wss://s.altnet.rippletest.net:51233") // Testnet
let wallet = null
async function c(){await client.connect()}
c()

document.getElementById("connect").onclick = () => {
  const req = {command:"account_info",account:"rHb9CJAWyB4rj91VRWn96DkukG4bwdtyTh"}
  client.request(req).then(() => {
    const url = `https://xaman.app/sign/${client._serverInfo.buildVersion}` // правильный QR
    const qr = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(url)}`
    document.getElementById("qr").innerHTML = `<img src="${qr}"><p>Скрин → Xaman → Import</p>`
    document.getElementById("qr").style.display = "block"
  })
}

// После успешного Accept в Xaman — страница обновится автоматически и покажет кнопки
if (window.location.hash.includes("success")) {
  wallet = xrpl.Wallet.fromSeed(localStorage.getItem("seed")) // тест
  document.getElementById("connect").textContent = "Подключено"
  document.getElementById("actions").style.display = "block"
}
</script></body></html>