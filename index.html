<!DOCTYPE html>
<html><head><meta charset="utf-8"><title>XRP ↔ USDC swap</title>
<style>
body{background:#000;color:#fff;font-family:system-ui;text-align:center;padding:20px}
button{background:#1d9bf0;padding:15px 30px;font-size:18px;border:none;border-radius:12px;color:#fff;margin:10px;cursor:pointer}
#qr img{width:280px;height:280px}
#actions{display:none;margin-top:30px}
input{width:80%;padding:12px;font-size:18px;border-radius:8px;border:1px solid #444;background:#111;color:#fff}
pre{background:#111;padding:15px;border-radius:8px;margin-top:20px;overflow:auto}
</style></head><body>

<h1>XRP ↔ USDC • XRPL Testnet</h1>
<button id="connect">Connect Xaman</button>
<div id="qr"></div>

<div id="actions">
  <input id="amt" value="100" placeholder="Сколько XRP">
  <br><button onclick="swap()">Swap → USDC</button>
  <br><button onclick="swapBack()">Swap → XRP</button>
</div>

<pre id="log">Готов</pre>

<script src="https://unpkg.com/xrpl@latest"></script>
<script>
const client = new xrpl.Client("wss://s.altnet.rippletest.net:51233")
await client.connect()
let wallet = null

document.getElementById("connect").onclick = () => {
  const uri = "xumm://xumm.app/signin"
  const qr = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(uri)}`
  document.getElementById("qr").innerHTML = `<img src="${qr}"><p>Скриншот → Xaman → Import from Gallery</p>`
  log("QR готов")
}

// Авто-подхват после Accept в Xaman
if (location.hash.includes("xumm")) {
  wallet = xrpl.Wallet.fromSeed(localStorage.getItem("xumm")) || alert("Кошелёк не найден")
  document.getElementById("connect").textContent = "Подключено " + wallet.address.slice(0,12)+"…"
  document.getElementById("actions").style.display = "block"
  log("Подключено")
}

function log(t){ document.getElementById("log").textContent = t + "\n" + document.getElementById("log").textContent }

async function swap(){
  const tx = await client.autofill({
    TransactionType: "Payment",
    Account: wallet.address,
    Amount: (Number(document.getElementById("amt").value)*1000000).toString(),
    Destination: wallet.address,
    Flags: 2147483648 // tfPartialPayment для AMM-свопа
  })
  const signed = wallet.sign(tx)
  const res = await client.submitAndWait(signed.tx_blob)
  log("Своп выполнен: " + res.result.meta.TransactionResult)
}
async function swapBack(){ alert("USDC → XRP скоро") }
</script>
</body></html>