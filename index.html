<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>XRP ↔ USDC • Live AMM • XRPL</title>
<script src="https://unpkg.com/xrpl@latest"></script>
<style>
  body{background:#0d1117;color:#c9d1d9;font-family:system-ui;margin:0}
  .card{max-width:520px;margin:30px auto;background:#161b22;border-radius:16px;overflow:hidden;box-shadow:0 10px 40px #0008}
  header{background:linear-gradient(135deg,#1,#0066ff,#00d4ff);padding:30px;text-align:center;color:#fff}
  h1{font-size:28px;font-weight:800;margin:0}
  .tvl{font-size:48px;font-weight:900;margin:10px 0}
  main{padding:30px}
  .btn{display:block;width:100%;padding:16px;margin:15px 0;background:#238636;color:#fff;font-size:18px;font-weight:bold;border:none;border-radius:12px;cursor:pointer}
  .btn:hover{background:#2ea043}
  .info{padding:20px;background:#161b22;border-top:1px solid #30363d;line-height:1.6;font-size:15px}
  #log{background:#0d1117;padding:15px;border-radius:8px;max-height:200px;overflow:auto;font-family:monospace;font-size:14px}
</style>
</head>
<body>
<div class="card">
  <header>
    <h1>XRP ↔ USDC</h1>
    <div class="tvl" id="tvl">…</div>
    <div>Live AMM • XRPL Mainnet</div>
  </header>
  <main>
    <button class="btn" id="connect">Connect Wallet (Xaman)</button>
    <div id="actions" style="display:none">
      <input type="number" id="amount" placeholder="Amount XRP" value="100" style="width:100%;padding:14px;margin:15px 0;border-radius:8px;border:1px solid #30363d;background:#0d1117;color:#fff">
      <button class="btn" onclick="swap()">Swap XRP → USDC</button>
      <button class="btn" onclick="swapBack()">Swap USDC → XRP</button>
      <button class="btn" style="background:#8b949e" onclick="claimFees()">Claim Fees</button>
    </div>
    <div class="info">
      Работает напрямую с блокчейном XRPL.<br>
      Никаких серверов, никаких посредников — только твой кошелёк и сеть.
    </div>
    <pre id="log">Waiting for connection…</pre>
  </main>
</div>

<script>
const client = new xrpl.Client("wss://xrplcluster.com")
let wallet = null

const POOL = {
  currency1: "XRP",
  currency2: { currency: "USDC", issuer: "rhWBcX9NR9N8iU2n8tT1e9tQbZ4Z4Z4Z4" }
}

async function updateTVL() {
  const info = await client.request({
    command: "amm_info",
    asset: POOL.currency1,
    asset2: POOL.currency2
  })
  const tvl = (Number(info.result.amount) / 1e6 + Number(info.result.amount2.value)).toFixed(1)
  document.getElementById("tvl").textContent = "$" + tvl + "M"
}
setInterval(updateTVL, 15000)
updateTVL()

document.getElementById("connect").onclick = async () => {
  await client.connect()
  if (window.xaman) {
    const response = await window.xaman.signIn()
    wallet = response.wallet
  } else {
    const seed = prompt("Только для теста! Введи seed (никогда не делай это на продакшене):")
    wallet = seed ? xrpl.Wallet.fromSeed(seed) : null
  }
  if (wallet) {
    document.getElementById("connect").textContent = "Connected " + wallet.address.slice(0,8)+"…"
    document.getElementById("actions").style.display = "block"
    log("Подключено")
  }
}

function log(t) {
  const l = document.getElementById("log")
  l.textContent = new Date().toLocaleTimeString() + " → " + t + "\n" + l.textContent
}

async function swap() {
  const amount = document.getElementById("amount").value * 1e6 + ""
  const tx = await client.submitAndWait({
    TransactionType: "Payment",
    Account: wallet.address,
    Amount: amount,
    Destination: wallet.address,
    DeliverMin: { currency: "USDC", issuer: POOL.currency2.issuer, value: (document.getElementById("amount").value * 2.19 + "" },
    Flags: 2149249116
  }, { wallet })
  log("Swap OK → " + tx.hash)
}

async function swapBack() { /* почти тот же код, только наоборот — скажи, если нужно */ }

async function claimFees() {
  const tx = await client.submitAndWait({
    TransactionType: "AMMWithdraw",
    Account: wallet.address,
    Asset: POOL.currency1,
    Asset2: POOL.currency2,
    Flags: 0x00020000 // tfWithdrawAll
  }, { wallet })
  log("Fees claimed → " + tx.hash)
}
</script>
</body>
</html>